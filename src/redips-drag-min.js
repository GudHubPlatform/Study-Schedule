export var REDIPS=REDIPS||{};REDIPS.drag=function(){var e,t,o,r,n,l,d=null,a=/\bredips-drag\b/i,i=0,s=0,c=null,f=null,p=[],g=null,u=0,$=0,m=0,v=0,h=0,b=0,E=[],I=[],y=[],_=null,D=null,R=0,S=0,w=0,P=0,N=!1,x=!1,T=!1,C=[],B=null,k=null,j=null,O=null,L=null,A=null,M=null,H=null,W=null,X=!1,Y=!1,q="cell",V={div:{},divClass:{},cname:"redips-only",other:"deny"},z={action:"deny",cname:"redips-mark",exception:{},exceptionClass:{}},G={},U={keyDiv:!1,keyRow:!1,sendBack:!1,drop:!1},J=function(){return!1},K=function(e){E.length=0;var o,r,n=void 0===e?_.getElementsByTagName("table"):document.querySelectorAll(e);for(o=e=0;e<n.length;e++)if(!("redips_clone"===n[e].parentNode.id||-1<n[e].className.indexOf("redips-nolayout"))){var l=n[e].parentNode,d=0;do"TD"===l.nodeName&&d++,l=l.parentNode;while(l&&l!==_);for(E[o]=n[e],E[o].redips||(E[o].redips={}),E[o].redips.container=_,E[o].redips.nestedLevel=d,E[o].redips.idx=o,C[o]=0,d=E[o].getElementsByTagName("td"),l=0,r=!1;l<d.length;l++)if(1<d[l].rowSpan){r=!0;break}E[o].redips.rowspan=r,o++}for(e=0,n=t=1;e<E.length;e++)if(0===E[e].redips.nestedLevel){for(o=0,E[e].redips.nestedGroup=n,E[e].redips.sort=100*t,l=E[e].getElementsByTagName("table");o<l.length;o++)-1<l[o].className.indexOf("redips-nolayout")||(l[o].redips.nestedGroup=n,l[o].redips.sort=100*t+l[o].redips.nestedLevel);n++,t++}},F=function(t){var n=t||window.event;if(!0===this.redips.animated||(n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),x=n.shiftKey,t=n.which?n.which:n.button,e_(n)||!n.touches&&1!==t))return!0;if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection&&"Text"===document.selection.type)try{document.selection.empty()}catch(l){}if(n.touches){t=R=n.touches[0].clientX;var a=S=n.touches[0].clientY}else t=R=n.clientX,a=S=n.clientY;w=t,P=a,N=!1,REDIPS.drag.objOld=Y=X||this,REDIPS.drag.obj=X=this,T=-1<X.className.indexOf("redips-clone"),REDIPS.drag.tableSort&&Z(X),_!==X.redips.container&&(_=X.redips.container,K()),em(),T||"cell"!==q||(X.style.zIndex=999),REDIPS.drag.td.source=G.source=ew("TD",X)||ew("TH",X),REDIPS.drag.td.current=G.current=G.source,REDIPS.drag.td.previous=G.previous=G.source,B=j=k=E.indexOf(ew("TABLE",G.source)),O=A=L=ew("TR",G.source).rowIndex,M=W=H=G.source.cellIndex;var i=eS(E[j],"position");return"fixed"!==i&&(i=eS(E[j].parentNode,"position")),y=e$(G.current,i),-1===X.className.indexOf("row")?(REDIPS.drag.mode=q="cell",REDIPS.drag.event.clicked(G.current)):(REDIPS.drag.mode=q="row",REDIPS.drag.obj=X=ee(X),REDIPS.drag.event.rowClicked(G.current)),!1===E[B].redips.enabled||(o=r=!1,REDIPS.event.add(document,"mousemove",ei),REDIPS.event.add(document,"touchmove",ei),REDIPS.event.add(document,"mouseup",er),REDIPS.event.add(document,"touchend",er),X.setCapture&&X.setCapture(),null!==B&&null!==O&&null!==M&&(e=eu(B,O,M)),i=e$(X,i),d=[a-i[0],i[1]-t,i[2]-a,t-i[3]],_.onselectstart=function(e){if(!e_(n=e||window.event))return n.shiftKey&&document.selection.clear(),!1},!1)},Q=function(e){REDIPS.drag.event.dblClicked()},Z=function(e){var o=ew("TABLE",e).redips.nestedGroup;for(e=0;e<E.length;e++)E[e].redips.nestedGroup===o&&(E[e].redips.sort=100*t+E[e].redips.nestedLevel);E.sort(function(e,t){return t.redips.sort-e.redips.sort}),t++},ee=function(e,t){if("DIV"===e.nodeName){var o,n,l=e;return void 0===(e=ew("TR",e)).redips&&(e.redips={}),e.redips.div=l,e}var d=e;void 0===d.redips&&(d.redips={}),e=ew("TABLE",e),T&&r&&((l=d.redips.div).className=eA(l.className.replace("redips-clone","")));var a=e.cloneNode(!0);T&&r&&(l.className+=" redips-clone");var i=a.rows.length-1;for(l="animated"!==t||0===i,o=i;0<=o;o--)if(o!==d.rowIndex){if(!0===l&&void 0===t){for(i=a.rows[o],n=0;n<i.cells.length;n++)if(-1<i.cells[n].className.indexOf("redips-rowhandler")){l=!1;break}}a.deleteRow(o)}return r||(d.redips.emptyRow=l),a.redips={},a.redips.container=e.redips.container,a.redips.sourceRow=d,eo(d,a.rows[0]),eI(d,a.rows[0]),document.getElementById("redips_clone").appendChild(a),e=e$(d,"fixed"),a.style.position="fixed",a.style.top=e[0]+"px",a.style.left=e[3]+"px",a.style.width=e[1]-e[3]+"px",a},et=function(e,t,o){var n=!1,l=function(e){void 0!==e.redips&&e.redips.emptyRow?eH(e,"empty",REDIPS.drag.style.rowEmptyColor):ew("TABLE",e).deleteRow(e.rowIndex)};void 0===o?o=X:n=!0;var d=o.redips.sourceRow,a=d.rowIndex,i=ew("TABLE",d),s=d.parentNode;t>(e=E[e]).rows.length-1&&(t=e.rows.length-1);var c=e.rows[t],f=t,p=c.parentNode;t=o.getElementsByTagName("tr")[0],o.parentNode.removeChild(o),!1!==REDIPS.drag.event.rowDroppedBefore(i,a)&&(!n&&-1<G.target.className.indexOf(REDIPS.drag.trash.className)?r?REDIPS.drag.event.rowDeleted():REDIPS.drag.trash.questionRow?confirm(REDIPS.drag.trash.questionRow)?(l(d),REDIPS.drag.event.rowDeleted()):(delete Y.redips.emptyRow,REDIPS.drag.event.rowUndeleted()):(l(d),REDIPS.drag.event.rowDeleted()):(f<e.rows.length?B===j?a>f?p.insertBefore(t,c):p.insertBefore(t,c.nextSibling):"after"===REDIPS.drag.rowDropMode?p.insertBefore(t,c.nextSibling):p.insertBefore(t,c):(p.appendChild(t),c=e.rows[0]),c&&c.redips&&c.redips.emptyRow?e.deleteRow(c.rowIndex):"overwrite"===REDIPS.drag.rowDropMode?l(c):"switch"!==REDIPS.drag.rowDropMode||r||(s.insertBefore(c,d),void 0!==d.redips&&delete d.redips.emptyRow),!n&&r||l(d),delete t.redips.emptyRow,n||REDIPS.drag.event.rowDropped(t,i,a)),0<t.getElementsByTagName("table").length&&K())},eo=function(e,t){var o=[],r=[];for(o[0]=e.getElementsByTagName("input"),o[1]=e.getElementsByTagName("textarea"),o[2]=e.getElementsByTagName("select"),r[0]=t.getElementsByTagName("input"),r[1]=t.getElementsByTagName("textarea"),r[2]=t.getElementsByTagName("select"),e=0;e<o.length;e++)for(t=0;t<o[e].length;t++){var n=o[e][t].type;switch(n){case"text":case"textarea":case"password":r[e][t].value=o[e][t].value;break;case"radio":case"checkbox":r[e][t].checked=o[e][t].checked;break;case"select-one":r[e][t].selectedIndex=o[e][t].selectedIndex;break;case"select-multiple":for(n=0;n<o[e][t].options.length;n++)r[e][t].options[n].selected=o[e][t].options[n].selected}}},er=function(t){var n=t||window.event;t=n.clientX;var l=n.clientY;if(h=b=0,X.releaseCapture&&X.releaseCapture(),REDIPS.event.remove(document,"mousemove",ei),REDIPS.event.remove(document,"touchmove",ei),REDIPS.event.remove(document,"mouseup",er),REDIPS.event.remove(document,"touchend",er),_.onselectstart=null,ed(X),c=document.documentElement.scrollWidth,f=document.documentElement.scrollHeight,h=b=0,r&&"cell"===q&&(null===B||null===O||null===M))X.parentNode.removeChild(X),--I[Y.id],REDIPS.drag.event.notCloned();else if(null===B||null===O||null===M)REDIPS.drag.event.notMoved();else{if(B<E.length){n=E[B],REDIPS.drag.td.target=G.target=n.rows[O].cells[M],eg(B,O,M,e);var d=B,a=O}else null===k||null===L||null===H?(n=E[j],REDIPS.drag.td.target=G.target=n.rows[A].cells[W],eg(j,A,W,e),d=j,a=A):(n=E[k],REDIPS.drag.td.target=G.target=n.rows[L].cells[H],eg(k,L,H,e),d=k,a=L);if("row"===q){if(o){if(j===d&&A===a){for(t=0,n=X.getElementsByTagName("tr")[0],Y.style.backgroundColor=n.style.backgroundColor;t<n.cells.length;t++)Y.cells[t].style.backgroundColor=n.cells[t].style.backgroundColor;X.parentNode.removeChild(X),delete Y.redips.emptyRow,r?REDIPS.drag.event.rowNotCloned():REDIPS.drag.event.rowDroppedSource(G.target)}else et(d,a)}else REDIPS.drag.event.rowNotMoved()}else if(r||N){if(r&&j===B&&A===O&&W===M)X.parentNode.removeChild(X),--I[Y.id],REDIPS.drag.event.notCloned();else if(r&&!1===REDIPS.drag.clone.drop&&(t<n.redips.offset[3]||t>n.redips.offset[1]||l<n.redips.offset[0]||l>n.redips.offset[2]))X.parentNode.removeChild(X),--I[Y.id],REDIPS.drag.event.notCloned();else if(-1<G.target.className.indexOf(REDIPS.drag.trash.className))X.parentNode.removeChild(X),REDIPS.drag.trash.question?setTimeout(function(){confirm(REDIPS.drag.trash.question)?ea():(r||(E[j].rows[A].cells[W].appendChild(X),em()),REDIPS.drag.event.undeleted())},20):ea();else if("switch"===REDIPS.drag.dropMode){if(!1===(t=REDIPS.drag.event.droppedBefore(G.target)))en(!1);else{for(X.parentNode.removeChild(X),d=(n=G.target.getElementsByTagName("div")).length,t=0;t<d;t++)void 0!==n[0]&&(REDIPS.drag.objOld=Y=n[0],G.source.appendChild(Y),el(Y));en(),d&&REDIPS.drag.event.switched()}}else"overwrite"===REDIPS.drag.dropMode?!1!==(t=REDIPS.drag.event.droppedBefore(G.target))&&eB(G.target):t=REDIPS.drag.event.droppedBefore(G.target),en(t)}else REDIPS.drag.event.notMoved();"cell"===q&&0<X.getElementsByTagName("table").length&&K(),em(),REDIPS.drag.event.finish()}k=L=H=null},en=function(e){var t,o=null;if(!1!==e){if(!0===U.sendBack){for(t=0,e=G.target.getElementsByTagName("DIV");t<e.length;t++)if(X!==e[t]&&0===X.id.indexOf(e[t].id)){o=e[t];break}if(o){ey(o,1),X.parentNode.removeChild(X);return}}"shift"===REDIPS.drag.dropMode&&(eM(G.target)||"always"===REDIPS.drag.shift.after)&&ek(G.source,G.target),"top"===REDIPS.drag.multipleDrop&&G.target.hasChildNodes()?G.target.insertBefore(X,G.target.firstChild):G.target.appendChild(X),el(X),REDIPS.drag.event.dropped(G.target),r&&(REDIPS.drag.event.clonedDropped(G.target),ey(Y,-1))}else r&&X.parentNode&&X.parentNode.removeChild(X)},el=function(e,t){!1===t?(e.onmousedown=null,e.ontouchstart=null,e.ondblclick=null):(e.onmousedown=F,e.ontouchstart=F,e.ondblclick=Q)},ed=function(e){e.style.top="",e.style.left="",e.style.position="",e.style.zIndex=""},ea=function(){if(r&&ey(Y,-1),"shift"===REDIPS.drag.dropMode&&("delete"===REDIPS.drag.shift.after||"always"===REDIPS.drag.shift.after)){switch(REDIPS.drag.shift.mode){case"vertical2":var e="lastInColumn";break;case"horizontal2":e="lastInRow";break;default:e="last"}ek(G.source,eP(e,G.source)[2])}REDIPS.drag.event.deleted(r)},ei=function(e){e=e||window.event;var t=REDIPS.drag.scroll.bound;if(e.touches)var n=R=e.touches[0].clientX,l=S=e.touches[0].clientY;else n=R=e.clientX,l=S=e.clientY;var a=Math.abs(w-n),g=Math.abs(P-l);if(!o&&("cell"===q&&(T||!0===REDIPS.drag.clone.keyDiv&&x)?(REDIPS.drag.objOld=Y=X,REDIPS.drag.obj=X=eE(X,!0),r=!0,REDIPS.drag.event.cloned()):("row"===q&&((T||!0===REDIPS.drag.clone.keyRow&&x)&&(r=!0),REDIPS.drag.objOld=Y=X,REDIPS.drag.obj=X=ee(X),X.style.zIndex=999),X.setCapture&&X.setCapture(),X.style.position="fixed",em(),ef(),"row"===q&&(r?REDIPS.drag.event.rowCloned():REDIPS.drag.event.rowMoved())),ep(),n>i-d[1]&&(X.style.left=i-(d[1]+d[3])+"px"),l>s-d[2]&&(X.style.top=s-(d[0]+d[2])+"px")),o=!0,"cell"===q&&(7<a||7<g)&&!N&&(N=!0,ep(),REDIPS.drag.event.moved(r)),n>d[3]&&n<i-d[1]&&(X.style.left=n-d[3]+"px"),l>d[0]&&l<s-d[2]&&(X.style.top=l-d[0]+"px"),n<D[1]&&n>D[3]&&l<D[2]&&l>D[0]&&0===h&&0===b&&(y.containTable||n<y[3]||n>y[1]||l<y[0]||l>y[2])&&(ef(),es()),REDIPS.drag.scroll.enable)for(0<(u=t-(i/2>n?n-d[3]:i-n-d[1]))?(u>t&&(u=t),a=ev()[0],0>(u*=n<i/2?-1:1)&&0>=a||0<u&&a>=c-i||0!=h++||(REDIPS.event.remove(window,"scroll",em),eh(window))):u=0,0<($=t-(s/2>l?l-d[0]:s-l-d[2]))?($>t&&($=t),a=ev()[1],0>($*=l<s/2?-1:1)&&0>=a||0<$&&a>=f-s||0!=b++||(REDIPS.event.remove(window,"scroll",em),eb(window))):$=0,g=0;g<p.length;g++)if((a=p[g]).autoscroll&&n<a.offset[1]&&n>a.offset[3]&&l<a.offset[2]&&l>a.offset[0]){0<(m=t-(a.midstX>n?n-d[3]-a.offset[3]:a.offset[1]-n-d[1]))?(m>t&&(m=t),m*=n<a.midstX?-1:1,0==h++&&(REDIPS.event.remove(a.div,"scroll",em),eh(a.div))):m=0,0<(v=t-(a.midstY>l?l-d[0]-a.offset[0]:a.offset[2]-l-d[2]))?(v>t&&(v=t),v*=l<a.midstY?-1:1,0==b++&&(REDIPS.event.remove(a.div,"scroll",em),eb(a.div))):v=0;break}else m=v=0;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},es=function(){B<E.length&&(B!==k||O!==L||M!==H)&&(null!==k&&null!==L&&null!==H&&(eg(k,L,H,e),REDIPS.drag.td.previous=G.previous=E[k].rows[L].cells[H],REDIPS.drag.td.current=G.current=E[B].rows[O].cells[M],"switching"===REDIPS.drag.dropMode&&"cell"===q&&(eC(G.current,G.previous),em(),ef()),"cell"===q?REDIPS.drag.event.changed(G.current):"row"!==q||B===k&&O===L||REDIPS.drag.event.rowChanged(G.current)),ep())},ec=function(){"number"==typeof window.innerWidth?(i=window.innerWidth,s=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(i=document.documentElement.clientWidth,s=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(i=document.body.clientWidth,s=document.body.clientHeight),c=document.documentElement.scrollWidth,f=document.documentElement.scrollHeight,em()},ef=function(){var e,t=[],o=function(){null!==k&&null!==L&&null!==H&&(B=k,O=L,M=H)},r=function(e,t,o){var r,n=null;for(r in o)if(-1<e.indexOf(r)&&(n=!1,-1<t.indexOf(o[r]))){n=!0;break}return n},n=R,l=S;for(B=0;B<E.length;B++)if(!1!==E[B].redips.enabled&&(t[0]=E[B].redips.offset[0],t[1]=E[B].redips.offset[1],t[2]=E[B].redips.offset[2],t[3]=E[B].redips.offset[3],void 0!==E[B].sca&&(t[0]=t[0]>E[B].sca.offset[0]?t[0]:E[B].sca.offset[0],t[1]=t[1]<E[B].sca.offset[1]?t[1]:E[B].sca.offset[1],t[2]=t[2]<E[B].sca.offset[2]?t[2]:E[B].sca.offset[2],t[3]=t[3]>E[B].sca.offset[3]?t[3]:E[B].sca.offset[3]),t[3]<n&&n<t[1]&&t[0]<l&&l<t[2])){var d=E[B].redips.rowOffset;for(O=0;O<d.length-1;O++)if(void 0!==d[O]){if(y[0]=d[O][0],void 0!==d[O+1])y[2]=d[O+1][0];else for(e=O+2;e<d.length;e++)if(void 0!==d[e]){y[2]=d[e][0];break}if(l<=y[2])break}e=O,O===d.length-1&&(y[0]=d[O][0],y[2]=E[B].redips.offset[2]);do for(M=t=E[B].rows[O].cells.length-1;0<=M;M--){t=E[B].rows[O].cells[M],y[3]=d[O][3]+t.offsetLeft,y[1]=y[3]+t.offsetWidth;var a=y[0]+(t.offsetTop-E[B].rows[O].offsetTop);if(y[3]<=n&&n<=y[1]&&a<=l&&l<=a+t.offsetHeight){y[0]=a,y[2]=a+t.offsetHeight;break}}while(E[B].redips.rowspan&&-1===M&&0<O--);if(0>O||0>M?o():O!==e&&(y[0]=d[O][0],y[2]=y[0]+E[B].rows[O].cells[M].offsetHeight,(l<y[0]||l>y[2])&&o()),t=E[B].rows[O].cells[M],y.containTable=0<t.childNodes.length&&0<t.getElementsByTagName("table").length,-1===t.className.indexOf(REDIPS.drag.trash.className)){if(n=r(X.className,t.className,V.divClass),-1<t.className.indexOf(REDIPS.drag.only.cname)){if(-1===t.className.indexOf(V.div[X.id])&&!0!==n){o();break}}else if(void 0===V.div[X.id]&&null===n||"deny"!==V.other){if((!0==(n=-1<t.className.indexOf(REDIPS.drag.mark.cname))&&"deny"===REDIPS.drag.mark.action||!1===n&&"allow"===REDIPS.drag.mark.action)&&(n=r(X.className,t.className,z.exceptionClass),-1===t.className.indexOf(z.exception[X.id])&&!0!==n)){o();break}}else{o();break}}if(r=-1<t.className.indexOf("redips-single"),"cell"===q){if(("single"===REDIPS.drag.dropMode||r)&&0<t.childNodes.length){if(1===t.childNodes.length&&3===t.firstChild.nodeType)break;for(r=!0,e=t.childNodes.length-1;0<=e;e--)if(t.childNodes[e].className&&-1<t.childNodes[e].className.indexOf("redips-drag")){r=!1;break}if(!r&&null!==k&&null!==L&&null!==H&&(j!==B||A!==O||W!==M)){o();break}}if(-1<t.className.indexOf("redips-rowhandler")){o();break}t.parentNode.redips&&t.parentNode.redips.emptyRow&&o()}break}},ep=function(){B<E.length&&null!==B&&null!==O&&null!==M&&(e=eu(B,O,M),eg(B,O,M),k=B,L=O,H=M)},eg=function(e,t,o,r){if("cell"===q&&N)(o=E[e].rows[t].cells[o].style).backgroundColor=void 0===r?REDIPS.drag.hover.colorTd:r.color[0].toString(),void 0!==REDIPS.drag.hover.borderTd&&(void 0===r?o.border=REDIPS.drag.hover.borderTd:(o.borderTopWidth=r.top[0][0],o.borderTopStyle=r.top[0][1],o.borderTopColor=r.top[0][2],o.borderRightWidth=r.right[0][0],o.borderRightStyle=r.right[0][1],o.borderRightColor=r.right[0][2],o.borderBottomWidth=r.bottom[0][0],o.borderBottomStyle=r.bottom[0][1],o.borderBottomColor=r.bottom[0][2],o.borderLeftWidth=r.left[0][0],o.borderLeftStyle=r.left[0][1],o.borderLeftColor=r.left[0][2]));else if("row"===q)for(e=E[e].rows[t],t=0;t<e.cells.length;t++)(o=e.cells[t].style).backgroundColor=void 0===r?REDIPS.drag.hover.colorTr:r.color[t].toString(),void 0!==REDIPS.drag.hover.borderTr&&(void 0===r?B===j?O<A?o.borderTop=REDIPS.drag.hover.borderTr:o.borderBottom=REDIPS.drag.hover.borderTr:"before"===REDIPS.drag.rowDropMode?o.borderTop=REDIPS.drag.hover.borderTr:o.borderBottom=REDIPS.drag.hover.borderTr:(o.borderTopWidth=r.top[t][0],o.borderTopStyle=r.top[t][1],o.borderTopColor=r.top[t][2],o.borderBottomWidth=r.bottom[t][0],o.borderBottomStyle=r.bottom[t][1],o.borderBottomColor=r.bottom[t][2]))},eu=function(e,t,o){var r={color:[],top:[],right:[],bottom:[],left:[]},n=function(e,t){return[eS(e,"border"+t+"Width"),eS(e,"border"+t+"Style"),eS(e,"border"+t+"Color")]};if("cell"===q)o=E[e].rows[t].cells[o],r.color[0]=o.style.backgroundColor,void 0!==REDIPS.drag.hover.borderTd&&(r.top[0]=n(o,"Top"),r.right[0]=n(o,"Right"),r.bottom[0]=n(o,"Bottom"),r.left[0]=n(o,"Left"));else for(e=E[e].rows[t],t=0;t<e.cells.length;t++)o=e.cells[t],r.color[t]=o.style.backgroundColor,void 0!==REDIPS.drag.hover.borderTr&&(r.top[t]=n(o,"Top"),r.bottom[t]=n(o,"Bottom"));return r},e$=function(e,t,o){var r=0,l=0,d=e;if("fixed"!==t&&(r=0-n[0],l=0-n[1]),void 0===o||!0===o)do r+=e.offsetLeft-e.scrollLeft,l+=e.offsetTop-e.scrollTop,e=e.offsetParent;while(e&&"BODY"!==e.nodeName);else do r+=e.offsetLeft,l+=e.offsetTop,e=e.offsetParent;while(e&&"BODY"!==e.nodeName);return[l,r+d.offsetWidth,l+d.offsetHeight,r]},em=function(){var e,t;for(e=0,n=ev();e<E.length;e++){var o=[],r=eS(E[e],"position");for("fixed"!==r&&(r=eS(E[e].parentNode,"position")),t=E[e].rows.length-1;0<=t;t--)"none"!==E[e].rows[t].style.display&&(o[t]=e$(E[e].rows[t],r));E[e].redips.offset=e$(E[e],r),E[e].redips.rowOffset=o}for(e=0,D=e$(_);e<p.length;e++)r=eS(p[e].div,"position"),t=e$(p[e].div,r,!1),p[e].offset=t,p[e].midstX=(t[1]+t[3])/2,p[e].midstY=(t[0]+t[2])/2},ev=function(){if("number"==typeof window.pageYOffset)var e=window.pageXOffset,t=window.pageYOffset;else document.body&&(document.body.scrollLeft||document.body.scrollTop)?(e=document.body.scrollLeft,t=document.body.scrollTop):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?(e=document.documentElement.scrollLeft,t=document.documentElement.scrollTop):e=t=0;return[e,t]},eh=function(e){var t=R,o=S;0<h&&(em(),ef(),t<D[1]&&t>D[3]&&o<D[2]&&o>D[0]&&es()),"object"==typeof e&&(g=e),g===window?(e=ev()[0],t=c-i,o=u):(e=g.scrollLeft,t=g.scrollWidth-g.clientWidth,o=m),0<h&&(0>o&&0<e||0<o&&e<t)?(g===window?(window.scrollBy(o,0),ev(),e=parseInt(X.style.left,10),isNaN(e)):g.scrollLeft+=o,setTimeout(eh,REDIPS.drag.scroll.speed)):(REDIPS.event.add(g,"scroll",em),h=0,y=[0,0,0,0])},eb=function(e){var t=R,o=S;0<b&&(em(),ef(),t<D[1]&&t>D[3]&&o<D[2]&&o>D[0]&&es()),"object"==typeof e&&(g=e),g===window?(e=ev()[1],t=f-s,o=$):(e=g.scrollTop,t=g.scrollHeight-g.clientHeight,o=v),0<b&&(0>o&&0<e||0<o&&e<t)?(g===window?(window.scrollBy(0,o),ev(),e=parseInt(X.style.top,10),isNaN(e)):g.scrollTop+=o,setTimeout(eb,REDIPS.drag.scroll.speed)):(REDIPS.event.add(g,"scroll",em),b=0,y=[0,0,0,0])},eE=function(e,t){var o=e.cloneNode(!0),r=o.className;if(!0===t){document.getElementById("redips_clone").appendChild(o),o.style.zIndex=999,o.style.position="fixed",t=e$(e);var n=e$(o);o.style.top=t[0]-n[0]+"px",o.style.left=t[3]-n[3]+"px"}return o.setCapture&&o.setCapture(),r=(r=r.replace("redips-clone","")).replace(/climit(\d)_(\d+)/,""),o.className=eA(r),void 0===I[e.id]&&(I[e.id]=0),o.id=e.id+"c"+I[e.id],I[e.id]+=1,eI(e,o),o},eI=function(e,t){var o=[];o[0]=function(e,t){e.redips&&(t.redips={},t.redips.enabled=e.redips.enabled,t.redips.container=e.redips.container,e.redips.enabled&&el(t))},o[1]=function(e,t){e.redips&&(t.redips={},t.redips.emptyRow=e.redips.emptyRow)};var r=function(r){var n,l=["DIV","TR"],d=e.getElementsByTagName(l[r]);for(n=0,l=t.getElementsByTagName(l[r]);n<l.length;n++)o[r](d[n],l[n])};"DIV"===e.nodeName?o[0](e,t):"TR"===e.nodeName&&o[1](e,t),r(0),r(1)},ey=function(e,t){var o=e.className,r=o.match(/climit(\d)_(\d+)/);if(null!==r){var n=parseInt(r[1],10);0===(r=parseInt(r[2],10))&&1===t&&(o+=" redips-clone",2===n&&eD(!0,e)),r+=t,o=o.replace(/climit\d_\d+/g,"climit"+n+"_"+r),0>=r&&(o=o.replace("redips-clone",""),2===n?(eD(!1,e),REDIPS.drag.event.clonedEnd2()):REDIPS.drag.event.clonedEnd1()),e.className=eA(o)}},e_=function(e){if(e.srcElement){var t=e.srcElement.nodeName;e=e.srcElement.className}else t=e.target.nodeName,e=e.target.className;switch(t){case"A":case"INPUT":case"SELECT":case"OPTION":case"TEXTAREA":t=!0;break;default:t=/\bredips-nodrag\b/i.test(e)}return t},eD=function(e,t){var o,r=[],n=/\bredips-noautoscroll\b/i,l=REDIPS.drag.style.opacityDisabled;if(!0===e||"init"===e)var d=REDIPS.drag.style.borderEnabled,i="move",s=!0;else d=REDIPS.drag.style.borderDisabled,i="auto",s=!1;for(void 0===t?r=_.getElementsByTagName("div"):"string"==typeof t?r=document.querySelectorAll(t):"object"!=typeof t||"DIV"===t.nodeName&&-1!==t.className.indexOf("redips-drag")?r[0]=t:r=t.getElementsByTagName("div"),o=t=0;t<r.length;t++)if(a.test(r[t].className))"init"===e||void 0===r[t].redips?(r[t].redips={},r[t].redips.container=_):!0===e&&"number"==typeof l?(r[t].style.opacity="",r[t].style.filter=""):!1===e&&"number"==typeof l&&(r[t].style.opacity=l/100,r[t].style.filter="alpha(opacity="+l+")"),el(r[t],s),r[t].style.borderStyle=d,r[t].style.cursor=i,r[t].redips.enabled=s;else if("init"===e){var c=eS(r[t],"overflow");if("visible"!==c){REDIPS.event.add(r[t],"scroll",em),c=eS(r[t],"position");var f=e$(r[t],c,!1);for(c=!n.test(r[t].className),p[o]={div:r[t],offset:f,midstX:(f[1]+f[3])/2,midstY:(f[0]+f[2])/2,autoscroll:c},f=r[t].getElementsByTagName("table"),c=0;c<f.length;c++)f[c].sca=p[o];o++}}},eR=function(e){"object"==typeof e&&"DIV"===e.nodeName?e.parentNode.removeChild(e):"string"==typeof e&&(e=document.getElementById(e))&&e.parentNode.removeChild(e)},eS=function(e,t){var o;return e&&e.currentStyle?o=e.currentStyle[t]:e&&window.getComputedStyle&&(o=document.defaultView.getComputedStyle(e,null)[t]),o},ew=function(e,t,o){for(t=t.parentNode,void 0===o&&(o=0);t;){if(t.nodeName===e){if(0<o)o--;else break}t=t.parentNode}return t},eP=function(e,t){var o=ew("TABLE",t);switch(e){case"firstInColumn":e=0,t=t.cellIndex;break;case"firstInRow":e=t.parentNode.rowIndex,t=0;break;case"lastInColumn":e=o.rows.length-1,t=t.cellIndex;break;case"lastInRow":e=t.parentNode.rowIndex,t=o.rows[e].cells.length-1;break;case"last":e=o.rows.length-1,t=o.rows[e].cells.length-1;break;default:e=t=0}return[e,t,o.rows[e].cells[t]]},eN=function(e,t){200===e.status?ex(t.targetTable,e.responseText):REDIPS.drag.error.loadContent({type:0,message:"AJAX error: ["+e.status+"] "+e.statusText,content:null,rowIndex:null,cellIndex:null})},ex=function(e,t){if("string"==typeof e&&(e=document.getElementById(e)),null==e||"TABLE"!==e.nodeName)REDIPS.drag.error.loadContent({type:0,message:"Target table does not exist",content:null,rowIndex:null,cellIndex:null});else{if(Array.isArray(t))var o=t;else try{o=JSON.parse(t)}catch(r){REDIPS.drag.error.loadContent({type:0,message:r.message,content:null,rowIndex:null,cellIndex:null});return}for(t=0;t<o.length;t++){var n=o[t][0],l=o[t][1],d=o[t][2],a=o[t][3],i=o[t][4],s=document.createElement("div");if(s.id=n,s.className=eA("redips-drag "+a),s.innerHTML=i,void 0===e.rows[l]){if(!1===(s=REDIPS.drag.error.loadContent({type:1,message:"Target TR ["+l+"] does not exist",content:i,rowIndex:l,cellIndex:d})))break}else if(void 0===e.rows[l].cells[d]){if(!1===(s=REDIPS.drag.error.loadContent({type:2,message:"Target TD ["+l+","+d+"] does not exist",content:i,rowIndex:l,cellIndex:d})))break}else e.rows[l].cells[d].appendChild(s),eD(!0,s)}}},eT=function(e,t,o){var r,n="GET",d="";void 0===l&&(l=new XMLHttpRequest),"object"==typeof o&&("string"==typeof o.method&&"POST"===o.method&&(n="POST"),"string"==typeof o.data&&(d=o.data)),l.open(n,e,!0),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&(200===l.status||!1!==(r=REDIPS.drag.error.ajax(l,o)))&&"function"==typeof t&&t.call(this,l,o)},l.setRequestHeader("X-Requested-With","XMLHttpRequest"),"GET"===n?l.send(null):(l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(d))},eC=function(e,t,o){var r=function(e,t){REDIPS.drag.event.relocateBefore(e,t);var o=REDIPS.drag.getPosition(t);REDIPS.drag.moveObject({obj:e,target:o,callback:function(e){var o=REDIPS.drag.findParent("TABLE",e),r=o.redips.idx;REDIPS.drag.event.relocateAfter(e,t),C[r]--,0===C[r]&&(REDIPS.drag.event.relocateEnd(),REDIPS.drag.enableTable(!0,o))}})};if(e!==t&&"object"==typeof e&&"object"==typeof t){var n=e.childNodes.length;if("animation"===o){if(0<n){var l=(o=ew("TABLE",t)).redips.idx;for(REDIPS.drag.enableTable(!1,o),o=0;o<n;o++)1===e.childNodes[o].nodeType&&"DIV"===e.childNodes[o].nodeName&&(C[l]++,r(e.childNodes[o],t))}}else for(r=o=0;o<n;o++)1===e.childNodes[r].nodeType&&"DIV"===e.childNodes[r].nodeName?(l=e.childNodes[r],REDIPS.drag.event.relocateBefore(l,t),t.appendChild(l),l.redips&&!1!==l.redips.enabled&&el(l),REDIPS.drag.event.relocateAfter(l)):r++}},eB=function(e,t){var o=[];if("TD"===e.nodeName){var r=e.childNodes.length;if("test"===t)return e=G.source===e?void 0:0===e.childNodes.length||1===e.childNodes.length&&3===e.firstChild.nodeType;for(t=0;t<r;t++)o.push(e.childNodes[0]),e.removeChild(e.childNodes[0]);return o}},ek=function(e,t){var o,r,n,l=!1,d=function(e,t){REDIPS.drag.shift.animation?eC(e,t,"animation"):eC(e,t)},a=function(e){"delete"===REDIPS.drag.shift.overflow?eB(e):"source"===REDIPS.drag.shift.overflow?d(e,G.source):"object"==typeof REDIPS.drag.shift.overflow&&d(e,REDIPS.drag.shift.overflow),l=!1,REDIPS.drag.event.shiftOverflow(e)};if(e!==t){var i=REDIPS.drag.shift.mode,s=ew("TABLE",e),c=ew("TABLE",t),f=e0(c),p=s===c?[e.redips.rowIndex,e.redips.cellIndex]:[-1,-1],g=[t.redips.rowIndex,t.redips.cellIndex],u=c.rows.length,$=ej(c);switch(i){case"vertical2":e=s===c&&e.redips.cellIndex===t.redips.cellIndex?p:[u,t.redips.cellIndex];break;case"horizontal2":e=s===c&&e.parentNode.rowIndex===t.parentNode.rowIndex?p:[t.redips.rowIndex,$];break;default:e=s===c?p:[u,$]}for("vertical1"===i||"vertical2"===i?(i=1e3*e[1]+e[0]<1e3*g[1]+g[0]?1:-1,t=u,u=0,$=1):(i=1e3*e[0]+e[1]<1e3*g[0]+g[1]?1:-1,t=$,u=1,$=0),e[0]!==p[0]&&e[1]!==p[1]&&(l=!0);e[0]!==g[0]||e[1]!==g[1];)s=f[e[0]+"-"+e[1]],e[u]+=i,0>e[u]?(e[u]=t,e[$]--):e[u]>t&&(e[u]=0,e[$]++),void 0!==(p=f[e[0]+"-"+e[1]])&&(o=p),void 0!==s&&(r=s),void 0!==p&&void 0!==r||void 0!==o&&void 0!==s?(p=-1===o.className.indexOf(REDIPS.drag.mark.cname)?0:1,s=-1===r.className.indexOf(REDIPS.drag.mark.cname)?0:1,l&&0===p&&1===s&&a(o),1===p?0===s&&(n=r):(0===p&&1===s&&(r=n),d(o,r))):l&&void 0!==o&&void 0===r&&0==(p=-1===o.className.indexOf(REDIPS.drag.mark.cname)?0:1)&&a(o)}},e0=function(e){var t,o,r,n,l=[],d={},a=e.rows;for(t=0;t<a.length;t++)for(o=0;o<a[t].cells.length;o++){var i=a[t].cells[o];e=i.parentNode.rowIndex;var s=i.rowSpan||1,c=i.colSpan||1;for(r=0,l[e]=l[e]||[];r<l[e].length+1;r++)if(void 0===l[e][r]){var f=r;break}for(d[e+"-"+f]=i,void 0===i.redips&&(i.redips={}),i.redips.rowIndex=e,i.redips.cellIndex=f,r=e;r<e+s;r++)for(l[r]=l[r]||[],i=l[r],n=f;n<f+c;n++)i[n]="x"}return d},ej=function(e){"string"==typeof e&&(e=document.getElementById(e)),e=e.rows;var t,o,r,n=0;for(o=0;o<e.length;o++){for(r=t=0;r<e[o].cells.length;r++)t+=e[o].cells[r].colSpan||1;t>n&&(n=t)}return n},eO=function(e,t){var o=(t.k1-t.k2*e)*(t.k1-t.k2*e);e+=REDIPS.drag.animation.step*(4-3*o)*t.direction;var r=t.m*e+t.b;"horizontal"===t.type?(t.obj.style.left=e+"px",t.obj.style.top=r+"px"):(t.obj.style.left=r+"px",t.obj.style.top=e+"px"),e<t.last&&0<t.direction||e>t.last&&0>t.direction?setTimeout(function(){eO(e,t)},REDIPS.drag.animation.pause*o):(ed(t.obj),t.obj.redips&&(t.obj.redips.animated=!1),"cell"===t.mode?(!0===t.overwrite&&eB(t.targetCell),t.targetCell.appendChild(t.obj),t.obj.redips&&!1!==t.obj.redips.enabled&&el(t.obj)):et(eL(t.target[0]),t.target[1],t.obj),"function"==typeof t.callback&&t.callback(t.obj))},e1=function(e){var t,o,r=t=o=-1;return void 0===e?r=[r=B<E.length?E[B].redips.idx:null===k||null===L||null===H?E[j].redips.idx:E[k].redips.idx,O,M,t=E[j].redips.idx,A,W]:((e="string"==typeof e?document.getElementById(e):e)&&("TD"!==e.nodeName&&(e=ew("TD",e)),e&&"TD"===e.nodeName&&(r=e.cellIndex,t=e.parentNode.rowIndex,o=(o=ew("TABLE",e)).redips.idx)),r=[o,t,r]),r},eL=function(e){var t;for(t=0;t<E.length&&E[t].redips.idx!==e;t++);return t},eA=function(e){return void 0!==e&&(e=e.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ")),e},eM=function(e){var t;for(t=0;t<e.childNodes.length;t++)if(1===e.childNodes[t].nodeType)return!0;return!1},eH=function(e,t,o){var r,n;if("string"==typeof e&&(e=ew("TABLE",e=document.getElementById(e))),"TR"===e.nodeName)for(e=e.getElementsByTagName("td"),r=0;r<e.length;r++)if(e[r].style.backgroundColor=o||"","empty"===t)e[r].innerHTML="";else for(n=0;n<e[r].childNodes.length;n++)1===e[r].childNodes[n].nodeType&&(e[r].childNodes[n].style.opacity=t/100,e[r].childNodes[n].style.filter="alpha(opacity="+t+")");else e.style.opacity=t/100,e.style.filter="alpha(opacity="+t+")",e.style.backgroundColor=o||""};return{obj:X,objOld:Y,mode:q,td:G,hover:{colorTd:"#E7AB83",colorTr:"#E7AB83"},scroll:{enable:!0,bound:25,speed:20},only:V,mark:z,style:{borderEnabled:"solid",borderDisabled:"dotted",opacityDisabled:"",rowEmptyColor:"white"},trash:{className:"redips-trash",question:null,questionRow:null},saveParamName:"p",dropMode:"multiple",multipleDrop:"bottom",clone:U,animation:{pause:20,step:2,shift:!1},shift:{mode:"horizontal1",after:"default",overflow:"bunch"},rowDropMode:"before",tableSort:!0,init:function(e){if((void 0===e||"string"!=typeof e)&&(e="redips-drag"),null===(_=document.getElementById(e)))throw Error("REDIPS.drag: drag container is not set");n=ev(),document.getElementById("redips_clone")||((e=document.createElement("div")).id="redips_clone",e.style.width=e.style.height="1px",_.appendChild(e)),eD("init"),K(),ec(),REDIPS.event.add(window,"resize",ec);var t=_.getElementsByTagName("img");for(e=0;e<t.length;e++)REDIPS.event.add(t[e],"mousemove",J),REDIPS.event.add(t[e],"touchmove",J);REDIPS.event.add(window,"scroll",em)},initTables:K,enableDrag:eD,clearTable:function(e){var t;if("string"==typeof e&&(e=document.getElementById(e)),"object"!=typeof e||"TABLE"!==e.nodeName)console.log("REDIPS.drag.clearTable: input element is not HTML table");else for(t=(e=e.getElementsByTagName("DIV")).length-1;0<=t;t--)a.test(e[t].className)&&eR(e[t])},enableTable:function(e,t){var o;if("object"==typeof t&&"TABLE"===t.nodeName)t.redips.enabled=e;else for(o=0;o<E.length;o++)-1<E[o].className.indexOf(t)&&(E[o].redips.enabled=e)},cloneObject:eE,saveContent:function(e,t){var o,r,n,l="",d=[],a=REDIPS.drag.saveParamName;if("string"==typeof e&&(e=document.getElementById(e)),void 0!==e&&"object"==typeof e&&"TABLE"===e.nodeName){var i=e.rows.length;for(o=0;o<i;o++){var s=e.rows[o].cells.length;for(r=0;r<s;r++){var c=e.rows[o].cells[r];if(0<c.childNodes.length)for(n=0;n<c.childNodes.length;n++){var f=c.childNodes[n];if("DIV"===f.nodeName&&-1<f.className.indexOf("redips-drag")){var p=f.className.replace(/redips-\w+/g,"");p=eA(p);var g=f.innerText||f.textContent;l+=a+"[]="+f.id+"_"+o+"_"+r+"_"+p+"_"+g+"&",d.push([f.id,o,r,p,g])}}}}l="json"===t&&0<d.length?JSON.stringify(d):l.substring(0,l.length-1)}return l},loadContent:function(e,t){if(Array.isArray(t))ex(e,t);else if("string"==typeof t)try{JSON.parse(t),ex(e,t)}catch(o){eT(t,eN,{targetTable:e})}else REDIPS.drag.error.loadContent({type:0,message:"Invalid input parameter (URL or JSON is expected)",content:null,rowIndex:null,cellIndex:null})},ajaxCall:eT,relocate:eC,emptyCell:eB,moveObject:function(e){var t={direction:1};if(t.callback=e.callback,t.overwrite=e.overwrite,"string"==typeof e.id?t.obj=t.objOld=document.getElementById(e.id):"object"==typeof e.obj&&"DIV"===e.obj.nodeName&&(t.obj=t.objOld=e.obj),"row"===e.mode){t.mode="row";var o=eL(e.source[0]),r=e.source[1];if((Y=t.objOld=E[o].rows[r]).redips&&!0===Y.redips.emptyRow)return!1;t.obj=ee(t.objOld,"animated")}else if(t.obj&&-1<t.obj.className.indexOf("redips-row")){if(t.mode="row",t.obj=t.objOld=Y=ew("TR",t.obj),Y.redips&&!0===Y.redips.emptyRow)return!1;t.obj=ee(t.objOld,"animated")}else t.mode="cell";if("object"==typeof t.obj&&null!==t.obj){t.obj.style.zIndex=999,t.obj.redips&&_!==t.obj.redips.container&&(_=t.obj.redips.container,K());var n=(o=e$(t.obj))[1]-o[3],l=o[2]-o[0],d=o[3],a=o[0];return!0===e.clone&&"cell"===t.mode&&(t.obj=eE(t.obj,!0),REDIPS.drag.event.cloned(t.obj)),void 0===e.target?e.target=e1():"object"==typeof e.target&&"TD"===e.target.nodeName&&(e.target=e1(e.target)),t.target=e.target,o=eL(e.target[0]),r=e.target[1],e=e.target[2],r>E[o].rows.length-1&&(r=E[o].rows.length-1),t.targetCell=E[o].rows[r].cells[e],"cell"===t.mode?(r=(o=e$(t.targetCell))[1]-o[3],e=o[2]-o[0],n=o[3]+(r-n)/2,l=o[0]+(e-l)/2):(n=(o=e$(E[o].rows[r]))[3],l=o[0]),o=n-d,e=l-a,t.obj.style.position="fixed",Math.abs(o)>Math.abs(e)?(t.type="horizontal",t.m=e/o,t.b=a-t.m*d,t.k1=(d+n)/(d-n),t.k2=2/(d-n),d>n&&(t.direction=-1),o=d,t.last=n):(t.type="vertical",t.m=o/e,t.b=d-t.m*a,t.k1=(a+l)/(a-l),t.k2=2/(a-l),a>l&&(t.direction=-1),o=a,t.last=l),t.obj.redips&&(t.obj.redips.animated=!0),eO(o,t),[t.obj,t.objOld]}},shiftCells:ek,deleteObject:eR,getPosition:e1,rowOpacity:eH,rowEmpty:function(e,t,o){e=document.getElementById(e).rows[t],void 0===o&&(o=REDIPS.drag.style.rowEmptyColor),void 0===e.redips&&(e.redips={}),e.redips.emptyRow=!0,eH(e,"empty",o)},getScrollPosition:ev,getStyle:eS,findParent:ew,findCell:eP,event:{changed:function(){},clicked:function(){},cloned:function(){},clonedDropped:function(){},clonedEnd1:function(){},clonedEnd2:function(){},dblClicked:function(){},deleted:function(){},dropped:function(){},droppedBefore:function(){},finish:function(){},moved:function(){},notCloned:function(){},notMoved:function(){},shiftOverflow:function(){},relocateBefore:function(){},relocateAfter:function(){},relocateEnd:function(){},rowChanged:function(){},rowClicked:function(){},rowCloned:function(){},rowDeleted:function(){},rowDropped:function(){},rowDroppedBefore:function(){},rowDroppedSource:function(){},rowMoved:function(){},rowNotCloned:function(){},rowNotMoved:function(){},rowUndeleted:function(){},switched:function(){},undeleted:function(){}},error:{ajax:function(){},loadContent:function(){}}}}(),REDIPS.event||(REDIPS.event={add:function(e,t,o){e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent?e.attachEvent("on"+t,o):e["on"+t]=o},remove:function(e,t,o){e.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent?e.detachEvent("on"+t,o):e["on"+t]=null}});